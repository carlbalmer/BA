\chapter{The localization system}

\label{Chapter3}

In chapter \ref{Chapter2} the two most common indoor localization approachers were introduced. In this chapter a localization system is proposed that combines those approaches, using fingerprinting to improve the range-based approach.

\paragraph{}The proposed system adds a room recognition system and new weighting method to the standard range-based approach (see chapter \ref{therory:range-based}). The room recognition uses fingerprinting with $RSSI$ and magnetic field data to determine the devices current room. The new weighting method then relies on the information provided by the room recognition to more accurately estimate the ranging error and improve the trilateration accuracy.

\begin{figure}[ht]
\centering
\includegraphics[width=\textwidth]{Figures/proposedApporach}
\decoRule
\caption[Proposed localization system]{Block diagram of the proposed localization system.}
\label{fig:proposedApproach}
\end{figure}

As apparent in the block diagram (Figure \ref{fig:proposedApproach}) the standard range-based approach is not changed but simply extended. Therefore the main focus of this thesis are the two added components; the proposed room recognition system and weighting method. In the remainder of this chapter those components are explained in detail. 

\subsection{Room Recognition}
The room recognition system is based on a fingerprinting approach. The fingerprint-map consists of $RSSI$ and magnetic field data ($B_{xyz}$). A multi-class SVM classifier is trained with the fingerprinting map and can then be employed to predict the devices room.

Wile fingerprinting can be labour intensive when used for accurate localization, applying it to the problem of room recognition solves some of this problem. In this case it is not required to measure the exact location of each sample. The samples only need to be labelled with the room. This makes the sample collection a lot faster.

Magnetic field data ($B_{xyz}$) is also included in the fingerprinting map. It is predicted that this will increase the accuracy of the room recognition system as previous work has shown the applicability of  magnetic field data for localization. \emph{This hypothesis needs to be confirmed in the evaluation.}

Another question to be answered is what kind of fingerprinting map yields the highest accuracy; \emph{a equally distributed map or a unequally distributed one with more samples at the borders }(walls and doors between rooms).

The support vector machine was chosen as the classifier because it is, compared to other common classifiers like k-NN , better suited for this kind of problem. It has no problems with outliers in the training data; It only chooses the most significant samples as support vectors. Also it performs well with a small amount of samples. k-NN on the other hand is very susceptible to outliers and generally needs more samples to offer good results.

\subsection{Weighting}

Supposed that the ranging error is mainly caused by obstructions to the signal (walls, wires etc.). This would mean that for any two samples inside one room the ranging error should be roughly the same. Therefore it should be possible to estimate the ranging error of a unknown sample by calculating the average error of some known training samples located in the same room.

The proposed weighting method defines the weights for each room as inversely proportional to the average ranging error for each anchor node. This results is a separate set of weights for each room. The room recognition is used to decide which set of weights to use.

For room $R$ the weight $w_{Ri}$ associated with the distance estimation $d_i$ to anchor node $AN_i$ is calculated based on all the training samples $S_R$ in the room.

\begin{equation}
\begin{split}
w_{Ri}\;\; & =\frac{E_i^{-1}}{\sum_{n=1}^{N}{E_n^{-1}}}\\
E_i\;\; & = \sum_{s=1}^{S_R}{(D_{si}-d_{si})^2}
\end{split}
\label{eqn: Room Weights}
\end{equation}

The inverse ranging error for anchor node $AN_i$ is divided by the sum of the inverse ranging error for all anchor nodes $N$. The ranging error is represented by the sum of the squared difference between the actual and estimated distance $(D_{si}-d_{si})^2$ for each training sample $s$ $(s=1..S)$.

In the remainder of this work this weighting method will be referred to as \emph{Room Weights}.

I could also be beneficial to combine the new \emph{Room Weights} with the \emph{Distance Weights} from equation \ref{eqn: distance weights} by adding them together.

%\begin{equation}
%w_{R+Di} = w_{Ri} + w_{Di}
%\label{eqn: Room + Distance Weights}
%\end{equation}

The effectiveness of both the \emph{Room Weights} and \emph{Room+Distance Weights} will need to be evaluated.